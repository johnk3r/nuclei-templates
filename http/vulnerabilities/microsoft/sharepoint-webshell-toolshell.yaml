id: sharepoint-webshell-toolshell

info:
  name: SharePoint Webshell - ToolShell
  author: johnk3r
  severity: critical
  description: |
    Detects the presence of a persistent webshell deployed on Microsoft SharePoint servers.
    The file 'spinstall0.aspx' leaks cryptographic machineKey values from SharePoint's configuration.
    This implant is associated with active exploitation campaigns following CVE-2025-53770 (ToolShell).
  reference:
    - https://research.eye.security/sharepoint-under-siege/
  tags: sharepoint,webshell,implant,aspx,backdoor

requests:
  - method: GET
    path:
      - "{{BaseURL}}/_layouts/15/spinstall0.aspx"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: dsl
        name: body-size
        dsl:
          - "len(body) <= 160"

      - type: regex
        name: malicious-pattern
        part: body
        regex:
          - '^[A-Z0-9]{64}\|HMACSHA256\|[A-Z0-9]{64}\|Auto\|Framework20SP1$'

      - type: word
        name: sharepoint-header
        part: header
        words:
          - "MicrosoftSharePointTeamServices"
        case-insensitive: true

    extractors:
      - type: regex
        name: machinekey
        part: body
        group: 0
        regex:
          - '^[A-Z0-9]{64}\|HMACSHA256\|[A-Z0-9]{64}\|Auto\|Framework20SP1$'
